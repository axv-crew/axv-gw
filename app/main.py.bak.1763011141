from app.metrics import ensure_build_metric as get_build_gauge
from app.metrics import ensure_build_metric as ensure_build_metric_ok
from app.metrics import ensure_build_metric
from fastapi import FastAPI

from prometheus_client import Gauge, generate_latest, CONTENT_TYPE_LATEST

_BUILD_GAUGE = None
# --- compat for tests: expose create_app if missing ---
try:
    create_app  # type: ignore[name-defined]
except NameError:
    def create_app():
        # return the already-constructed FastAPI app if present
        return globals().get("app")
# --- end compat ---
